<head>
  <title>Swiss Ladder</title>
</head>

<body>
</body>

<template name="appBody">
  {{> Template.dynamic template=main}}
</template>

<template name="laddersPage">
  <form class="createLadder">
    <input type="text" name="ladderName" placeholder="New ladder name">
  </form>
  <br/>
  {{#each ladders}}
    <div><a href="ladder/{{slug}}">{{name}}</a></div>
  {{/each}}
  <br/>
  <button class="clearDb" type="button">Clear DB</button>
</template>

<template name="ladderPage">
  <h1>{{ladderName}}</h1>
  <form class="addPlayer">
    <input type="text" name="playerName" placeholder="New player name">
  </form>
  <br/>
  <div>
    <button class="addSetup" type="button">Add Setup</button>
    {{#if setups.count}}
      Remove:
      {{#each setups}}
        <button class="removeSetup" type="button" value="{{_id}}">{{number}}</button>
      {{/each}}
    {{/if}}
  </div>

  {{#if started}}
    <div class="container">
      <div class="column">
        <h3>Playing</h3>
        <table class="withButtons">
          {{#each playing}}
            <tr>
              <td rowspan="2">{{setupNumber}}</td>
              <td>
                <label>
                  <input type="radio" form="playing{{_id}}" name="winner" value="player1">
                  {{player1Name}}{{#if player1Bonus}}*{{/if}}
                </label>
              </td>
              <td rowspan="2">
                <form class="winPlayer" id="playing{{_id}}">
                  <input type="hidden" name="pairingId" value="{{_id}}">
                  <button type="submit">Submit</button>
                </form>
              </td>
            </tr>
            <tr>
              <td>
                <label>
                  <input type="radio" form="playing{{_id}}" name="winner" value="player2">
                  {{player2Name}}{{#if player2Bonus}}*{{/if}}
                </label>
              </td>
            </tr>
            <tr></tr>
          {{/each}}
        </table>

        <h3>Waiting</h3>
        <table class="withButtons">
          {{#each waiting}}
            <tr>
              {{#if player1Id}}
                <td>
                  <form class="unqueueWaiting" id="waiting{{player1Id}}">
                    <input type="hidden" name="pairingId" value="{{_id}}">
                    <input type="hidden" name="quitter" value="player1">
                    {{player1Name}}{{#if player1Bonus}}*{{/if}}
                  </form>
                </td>
                <td rowspan="2">{{score}}</td>
                <td><button type="submit" form="waiting{{player1Id}}">Unqueue</button></td>
              {{else}}
                <td>?</td>
              {{/if}}
            </tr>
            <tr>
              {{#if player2Id}}
                <td>
                  <form class="unqueueWaiting" id="waiting{{player2Id}}">
                    <input type="hidden" name="pairingId" value="{{_id}}">
                    <input type="hidden" name="quitter" value="player2">
                    {{player2Name}}{{#if player2Bonus}}*{{/if}}
                  </form>
                </td>
                <td><button type="submit" form="waiting{{player2Id}}">Unqueue</button></td>
              {{else}}
                <td>?</td>
              {{/if}}
            </tr>
            <tr></tr>
          {{/each}}
        </table>

        <h3>Matchmaking</h3>
        <table class="withButtons">
          {{#each matchmaking}}
            <tr>
              <td>{{name}}{{#if hasBonuses bonuses games}}*{{/if}}</td>
              <td>{{score}}</td>
              <td>
                <button class="unqueueMatchmaking" type="button" value="{{_id}}">Unqueue</button>
              </td>
            </tr>
          {{/each}}
        </table>

        <h3>Unqueued</h3>
        <table class="withButtons">
          {{#each unqueued}}
            <tr>
              <td>{{name}}{{#if hasBonuses bonuses games}}*{{/if}}</td>
              <td>
                {{#if games}}
                  <button type="button" disabled>x</button>
                {{else}}
                  <button class="removePlayer" type="button" value="{{_id}}">x</button>
                {{/if}}
              </td>
              <td><button class="queuePlayer" type="button" value="{{_id}}">Queue</button></td>
            </tr>
          {{/each}}
        </table>
      </div>
      <div class="column">
        <h3>Standings</h3>
        <table class="withHeader">
          <thead><tr><td>Name</td><td>Score</td><td>W</td><td>L</td></tr></thead>
          <tbody>
            {{#each standings}}
              <tr>
                <td>{{name}}{{#if hasBonuses bonuses games}}*{{/if}}</td>
                <td>{{score}}</td>
                <td>{{wins}}</td>
                <td>{{losses}}</td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
      <div class="column">
        <h3>Matches</h3>
        <table class="withHeader withButtons">
          <thead><tr><td>Winner</td><td>Loser</td><td>Fix?</td></tr></thead>
          <tbody>
            {{#each matches}}
              <tr>
                <td>{{winnerName}}{{#if winnerBonus}}*{{/if}}</td>
                <td>{{loserName}}{{#if loserBonus}}*{{/if}}</td>
                <td>
                  {{#if unfixable}}
                    <button type="button" disabled>&#x21c4;</button>
                  {{else}}
                    <button class="fixMatch" type="button" value="{{_id}}">&#x21c4;</button>
                  {{/if}}
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
  {{else}}
    <br/>
    <form class="importFromSmashgg">
      <input type="text" name="slug" placeholder="Import from Smash.gg">
    </form>
    <br/>
    <button class="startLadder" type="button">Start</button>
    <div class="container">
      <div class="column">
        <h3>Players</h3>
        <table class="withButtons">
          {{#each players}}
            <tr>
              <td>{{name}}</td>
              <td><button class="removePlayer" type="button" value="{{_id}}">x</button></td>
            </tr>
          {{/each}}
        </table>
      </div>
      <div class="column">
        {{#if smashggImport}}
          <h3>{{smashggImport.name}}</h3>
          {{#if smashggImport.pool}}
            {{#with smashggImport.pool}}
              <h4>{{event}}, {{phase}}, {{group}}</h4>
              <button class="addAll" type="button">Add all</button>
              <button class="nextPoolIndex" type="button">Next</button>
              <table class="withButtons">
                {{#each entrant in entrants}}
                  <tr><td>{{entrant}}</td></tr>
                {{/each}}
              </table>
            {{/with}}
          {{/if}}
        {{/if}}
      </div>
    </div>
  {{/if}}
</template>
